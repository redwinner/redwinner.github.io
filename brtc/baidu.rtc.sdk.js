!function(e){var n={};function r(o){if(n[o])return n[o].exports;var t=n[o]={i:o,l:!1,exports:{}};return e[o].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=e,r.c=n,r.d=function(e,n,o){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var t in e)r.d(o,t,function(n){return e[n]}.bind(null,t));return o},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r(r.s=0)}([function(e,n){function r(e){if(void 0===r.initDone)return e.error("Library not initialized"),{};if(!r.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(r.log("Library initialized: "+r.initDone),(e=e||{}).success="function"==typeof e.success?e.success:jQuery.noop,e.error="function"==typeof e.error?e.error:jQuery.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:jQuery.noop,null===e.server||void 0===e.server)return e.error("Invalid gateway url"),{};var n=!1,o=null,t={},i=null,a=null,s=0,d=e.server;$.isArray(d)?(r.log("Multiple servers provided ("+d.length+"), will use the first that works"),d=null,a=e.server,r.debug(a)):0===d.indexOf("ws")?(n=!0,r.log("Using WebSockets to contact Janus: "+d)):(n=!1,r.log("Using REST API to contact Janus: "+d));var l=e.iceServers,u=e.iceTransportPolicy,c=e.ipv6;null==c&&(c=!1);var f=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(f=!0===e.withCredentials);var v=null;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(v=e.max_poll_events),v<1&&(v=1);var p=null;void 0!==e.token&&null!==e.token&&(p=e.token);var g=null;void 0!==e.apisecret&&null!==e.apisecret&&(g=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var m=!1,b=null,h={},w=this,y=0,S={};function x(){if(null!=b)if(r.debug("Long poll..."),m){var n=d+"/"+b+"?rid="+(new Date).getTime();null!=v&&(n=n+"&maxev="+v),null!=p&&(n=n+"&token="+p),null!=g&&(n=n+"&apisecret="+g),r.debug(n),$.ajax({type:"GET",url:n,xhrFields:{withCredentials:f},cache:!1,timeout:6e4,success:k,error:function(n,o,t){if(r.error(o+": "+t),++y>10)return m=!1,void e.error("Lost connection to the gateway (is it down?)");x()},dataType:"json"})}else r.warn("Is the gateway down? (connected=false)")}function k(e){if(y=0,n||null==b||setTimeout(x,200),n||!$.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus){if("webrtcup"===e.janus)return r.debug("Got a webrtcup event on session "+b),r.debug(e),null==(o=e.sender)?void r.warn("Missing sender..."):null==(i=h[o])?void r.debug("This handle is not attached to this session"):void i.webrtcState(!0);if("hangup"===e.janus){if(r.debug("Got a hangup event on session "+b),r.debug(e),null==(o=e.sender))return void r.warn("Missing sender...");if(null==(i=h[o]))return void r.debug("This handle is not attached to this session");i.webrtcState(!1,e.reason),i.hangup()}else if("detached"===e.janus){if(r.debug("Got a detached event on session "+b),r.debug(e),null==(o=e.sender))return void r.warn("Missing sender...");if(null==(i=h[o]))return;i.detached=!0,i.ondetached(),i.detach()}else if("media"===e.janus){if(r.debug("Got a media event on session "+b),r.debug(e),null==(o=e.sender))return void r.warn("Missing sender...");if(null==(i=h[o]))return void r.debug("This handle is not attached to this session");i.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(r.debug("Got a slowlink event on session "+b),r.debug(e),null==(o=e.sender))return void r.warn("Missing sender...");if(null==(i=h[o]))return void r.debug("This handle is not attached to this session");i.slowLink(e.uplink,e.nacks)}else{if("error"===e.janus){if(r.error("Ooops: "+e.error.code+" "+e.error.reason),r.debug(e),null!=(l=e.transaction))null!=(u=S[l])&&u(e),delete S[l];return}if("event"===e.janus){var o;if(r.debug("Got a plugin event on session "+b),r.debug(e),null==(o=e.sender))return void r.warn("Missing sender...");var t=e.plugindata;if(null==t)return void r.warn("Missing plugindata...");r.debug("  -- Event is coming from "+o+" ("+t.plugin+")");var i,a=t.data;if(r.debug(a),null==(i=h[o]))return void r.warn("This handle is not attached to this session");var s=e.jsep;null!=s&&(r.debug("Handling SDP as well..."),r.debug(s));var d=i.onmessage;null!=d?(r.debug("Notifying application..."),d(a,s)):r.debug("No provided notification callback")}else r.warn("Unkown message/event  '"+e.janus+"' on session "+b),r.debug(e)}}else{var l,u;r.debug("Got a success on session "+b),r.debug(e),null!=(l=e.transaction)&&(null!=(u=S[l])&&u(e),delete S[l])}else r.debug("Got an ack on session "+b),r.debug(e),null!=(l=e.transaction)&&(null!=(u=S[l])&&u(e),delete S[l]);else r.vdebug("Got a keepalive on session "+b);else for(var c=0;c<e.length;c++)k(e[c])}function j(){if(null!==d&&n&&m){i=setTimeout(j,3e4);var e={janus:"keepalive",session_id:b,transaction:r.randomString(12)};null!=p&&(e.token=p),null!=g&&(e.apisecret=g),o.send(JSON.stringify(e))}}function T(e,t){if((t=t||{}).success="function"==typeof t.success?t.success:jQuery.noop,t.error="function"==typeof t.error?t.error:jQuery.noop,!m)return r.warn("Is the gateway down? (connected=false)"),void t.error("Is the gateway down? (connected=false)");var i=t.message,a=t.jsep,s=r.randomString(12),l={janus:"message",body:i,transaction:s};if(null!=p&&(l.token=p),null!=g&&(l.apisecret=g),null!=a&&(l.jsep=a),r.debug("Sending message to plugin (handle="+e+"):"),r.debug(l),n)return l.session_id=b,l.handle_id=e,S[s]=function(e){if(r.debug("Message sent!"),r.debug(e),"success"===e.janus){var n=e.plugindata;if(null==n)return r.warn("Request succeeded, but missing plugindata..."),void t.success();r.log("Synchronous transaction successful ("+n.plugin+")");var o=n.data;return r.debug(o),void t.success(o)}"ack"===e.janus?t.success():void 0!==e.error&&null!==e.error?(r.error("Ooops: "+e.error.code+" "+e.error.reason),t.error(e.error.code+" "+e.error.reason)):(r.error("Unknown error"),t.error("Unknown error"))},void o.send(JSON.stringify(l));$.ajax({type:"POST",url:d+"/"+b+"/"+e,xhrFields:{withCredentials:f},cache:!1,contentType:"application/json",data:JSON.stringify(l),success:function(e){if(r.debug("Message sent!"),r.debug(e),"success"===e.janus){var n=e.plugindata;if(null==n)return r.warn("Request succeeded, but missing plugindata..."),void t.success();r.log("Synchronous transaction successful ("+n.plugin+")");var o=n.data;return r.debug(o),void t.success(o)}"ack"===e.janus?t.success():void 0!==e.error&&null!==e.error?(r.error("Ooops: "+e.error.code+" "+e.error.reason),t.error(e.error.code+" "+e.error.reason)):(r.error("Unknown error"),t.error("Unknown error"))},error:function(e,n,o){r.error(n+": "+o),t.error(n+": "+o)},dataType:"json"})}function D(e,t){if(m){var i={janus:"trickle",candidate:t,transaction:r.randomString(12)};if(null!=p&&(i.token=p),null!=g&&(i.apisecret=g),r.vdebug("Sending trickle candidate (handle="+e+"):"),r.vdebug(i),n)return i.session_id=b,i.handle_id=e,void o.send(JSON.stringify(i));$.ajax({type:"POST",url:d+"/"+b+"/"+e,xhrFields:{withCredentials:f},cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(e){r.vdebug("Candidate sent!"),r.vdebug(e),"ack"===e.janus||r.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,n,o){r.error(n+": "+o)},dataType:"json"})}else r.warn("Is the gateway down? (connected=false)")}function I(e,n){(n=n||{}).success="function"==typeof n.success?n.success:jQuery.noop,n.error="function"==typeof n.error?n.error:jQuery.noop;var o=h[e];if(null==o||null===o.webrtcStuff||void 0===o.webrtcStuff)return r.warn("Invalid handle"),void n.error("Invalid handle");var t=o.webrtcStuff,i=n.text;if(null==i)return r.warn("Invalid text"),void n.error("Invalid text");r.log("Sending string on data channel: "+i),t.dataChannel.send(i),n.success()}function R(e,n){(n=n||{}).success="function"==typeof n.success?n.success:jQuery.noop,n.error="function"==typeof n.error?n.error:jQuery.noop;var o=h[e];if(null==o||null===o.webrtcStuff||void 0===o.webrtcStuff)return r.warn("Invalid handle"),void n.error("Invalid handle");var t=o.webrtcStuff;if(null===t.dtmfSender||void 0===t.dtmfSender){if(void 0!==t.myStream&&null!==t.myStream){var i=t.myStream.getAudioTracks();if(null!=i&&i.length>0){var a=i[0];t.dtmfSender=t.pc.createDTMFSender(a),r.log("Created DTMF Sender"),t.dtmfSender.ontonechange=function(e){r.debug("Sent DTMF tone: "+e.tone)}}}if(null===t.dtmfSender||void 0===t.dtmfSender)return r.warn("Invalid DTMF configuration"),void n.error("Invalid DTMF configuration")}var s=n.dtmf;if(null==s)return r.warn("Invalid DTMF parameters"),void n.error("Invalid DTMF parameters");var d=s.tones;if(null==d)return r.warn("Invalid DTMF string"),void n.error("Invalid DTMF string");var l=s.duration;null==l&&(l=500);var u=s.gap;null==u&&(u=50),r.debug("Sending DTMF string "+d+" (duration "+l+"ms, gap "+u+"ms)"),t.dtmfSender.insertDTMF(d,l,u)}function C(e,t){(t=t||{}).success="function"==typeof t.success?t.success:jQuery.noop,t.error="function"==typeof t.error?t.error:jQuery.noop,r.warn(t);var i=!0;if(void 0!==t.asyncRequest&&null!==t.asyncRequest&&(i=!0===t.asyncRequest),r.log("Destroying handle "+e+" (async="+i+")"),L(e),h[e].detached)return delete h[e],void t.success();if(!m)return r.warn("Is the gateway down? (connected=false)"),void t.error("Is the gateway down? (connected=false)");var a={janus:"detach",transaction:r.randomString(12)};if(null!=p&&(a.token=p),null!=g&&(a.apisecret=g),n)return a.session_id=b,a.handle_id=e,o.send(JSON.stringify(a)),delete h[e],void t.success();$.ajax({type:"POST",url:d+"/"+b+"/"+e,async:i,xhrFields:{withCredentials:f},cache:!1,contentType:"application/json",data:JSON.stringify(a),success:function(n){r.log("Destroyed handle:"),r.debug(n),"success"!==n.janus&&r.error("Ooops: "+n.error.code+" "+n.error.reason),delete h[e],t.success()},error:function(n,o,i){r.error(o+": "+i),delete h[e],t.success()},dataType:"json"})}function O(e,n,o,t,i){var a=h[e];if(null==a||null===a.webrtcStuff||void 0===a.webrtcStuff)return r.warn("Invalid handle"),void t.error("Invalid handle");var s=a.webrtcStuff;r.debug("streamsDone:",i),s.myStream=i;var d={iceServers:l,iceTransportPolicy:u},f={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===c&&f.optional.push({googIPv6:!0}),"edge"===adapter.browserDetails.browser&&(d.bundlePolicy="max-bundle"),r.log("Creating PeerConnection"),r.debug(f),s.pc=new RTCPeerConnection(d,f),r.debug(s.pc),s.pc.getStats&&(s.volume.value=0,s.bitrate.value="0 kbits/sec"),r.log("Preparing local SDP and gathering candidates (trickle="+s.trickle+")"),s.pc.oniceconnectionstatechange=function(e){s.pc&&a.iceState(s.pc.iceConnectionState)},s.pc.onicecandidate=function(n){if(null==n.candidate||"edge"===adapter.browserDetails.browser&&n.candidate.candidate.indexOf("endOfCandidates")>0)r.log("End of candidates."),s.iceDone=!0,!0===s.trickle?D(e,{completed:!0}):function(e,n){(n=n||{}).success="function"==typeof n.success?n.success:jQuery.noop,n.error="function"==typeof n.error?n.error:jQuery.noop;var o=h[e];if(null==o||null===o.webrtcStuff||void 0===o.webrtcStuff)return void r.warn("Invalid handle, not sending anything");var t=o.webrtcStuff;if(r.log("Sending offer/answer SDP..."),null===t.mySdp||void 0===t.mySdp)return void r.warn("Local SDP instance is invalid, not sending anything...");if(t.mySdp={type:t.pc.localDescription.type,sdp:t.pc.localDescription.sdp},t.sdpSent)return void r.log("Offer/Answer SDP already sent, not sending it again");!1===t.trickle&&(t.mySdp.trickle=!1);r.debug(n),t.sdpSent=!0,n.success(t.mySdp)}(e,t);else{var o={candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex};if(!0===s.trickle){var i=n.candidate.candidate;r.log("test print candidate:"+i),-1==i.indexOf("UDP")&&-1==i.indexOf("udp")||D(e,o)}}},null!=i&&(r.log("Adding local stream"),s.pc.addStream(i),a.onlocalstream(i)),s.pc.onaddstream=function(e){r.log("Handling Remote Stream"),r.debug(e),s.remoteStream=e,a.onremotestream(e.stream)},function(e){if(r.debug("isDataEnabled:",e),"edge"==adapter.browserDetails.browser)return r.warn("Edge doesn't support data channels yet"),!1;return null!=e&&!0===e.data}(o)){r.log("Creating data channel");var v=function(){var e=null!==s.dataChannel?s.dataChannel.readyState:"null";r.log("State change on data channel: "+e),"open"===e&&a.ondataopen()};s.dataChannel=s.pc.createDataChannel("JanusDataChannel",{ordered:!1}),s.dataChannel.onmessage=function(e){r.log("Received message on data channel: "+e.data),a.ondata(e.data)},s.dataChannel.onopen=v,s.dataChannel.onclose=v,s.dataChannel.onerror=function(e){r.error("Got error on data channel:",e)}}null==n?P(e,o,t):("edge"===adapter.browserDetails.browser&&(n.sdp+="a=end-of-candidates\r\n"),s.pc.setRemoteDescription(new RTCSessionDescription(n),function(){r.log("Remote description accepted!"),_(e,o,t)},t.error))}function M(e,n){(n=n||{}).success="function"==typeof n.success?n.success:jQuery.noop,n.error="function"==typeof n.error?n.error:Q;var o=n.jsep,t=n.media,i=h[e];if(null==i||null===i.webrtcStuff||void 0===i.webrtcStuff)return r.warn("Invalid handle"),void n.error("Invalid handle");var a,s=i.webrtcStuff;if(void 0!==s.pc&&null!==s.pc)return r.log("Updating existing media session"),void(null==o?P(e,t,n):("edge"===adapter.browserDetails.browser&&(o.sdp+="a=end-of-candidates\r\n"),s.pc.setRemoteDescription(new RTCSessionDescription(o),function(){r.log("Remote description accepted!"),_(e,t,n)},n.error)));if(null!==n.stream&&void 0!==n.stream){var d=n.stream;return r.log("MediaStream provided by the application"),r.debug(d),s.streamExternal=!0,void O(e,o,t,n,d)}if(s.trickle=(a=n.trickle,r.debug("isTrickleEnabled:",a),null==a||!0===a),U(t)||G(t)){var l={mandatory:{},optional:[]};i.consentDialog(!0);var u=U(t);!0===u&&null!=t&&null!=t&&"object"==typeof t.audio&&(u=t.audio);var c=G(t);if(!0===c&&null!=t&&null!=t)if(t.video&&"screen"!=t.video&&"window"!=t.video){var f=0,v=0,p=0;if("lowres"===t.video)v=240,p=240,f=320;else if("lowres-16:9"===t.video)v=180,p=180,f=320;else if("hires"===t.video||"hires-16:9"===t.video){if(v=720,p=720,f=1280,navigator.mozGetUserMedia)(g=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10))<38&&(r.warn(t.video+" unsupported, falling back to stdres (old Firefox)"),v=480,p=480,f=640)}else"stdres"===t.video?(v=480,p=480,f=640):"stdres-16:9"===t.video?(v=360,p=360,f=640):(r.log("Default video setting ("+t.video+") is stdres 4:3"),v=480,p=480,f=640);if(r.log("Adding media constraint "+t.video),navigator.mozGetUserMedia){var g=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);c=g<38?{require:["height","width"],height:{max:p,min:v},width:{max:f,min:f}}:{height:{ideal:v},width:{ideal:f}}}else c={mandatory:{maxHeight:p,minHeight:v,maxWidth:f,minWidth:f},optional:[]};"object"==typeof t.video&&(c=t.video),r.debug(c)}else if("screen"===t.video||"window"===t.video){if(t.screenshareFrameRate||(t.screenshareFrameRate=3),"https:"!==window.location.protocol)return r.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),i.consentDialog(!1),void n.error("Screen sharing only works on HTTPS, try the https:// version of this page");var m={};function b(r,a){i.consentDialog(!1),r?n.error({code:r.code,name:r.name,message:r.message}):O(e,o,t,n,a)}function w(e,n){r.log("Adding media constraint (screen capture)"),r.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){n(null,e)}).catch(function(e){i.consentDialog(!1),n(e)})}if("chrome"===adapter.browserDetails.browser){var y=adapter.browserDetails.version,S=33;if(window.navigator.userAgent.match("Linux")&&(S=35),y>=26&&y<=S)w(l={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:t.screenshareFrameRate,maxFrameRate:t.screenshareFrameRate,chromeMediaSource:"screen"}},audio:U(t)},b);else{var x=window.setTimeout(function(){return(k=new Error("NavigatorUserMediaError")).name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',i.consentDialog(!1),n.error(k)},1e3);m[x]=[b,null],window.postMessage({type:"janusGetScreen",id:x},"*")}}else if(window.navigator.userAgent.match("Firefox")){if(!(parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)>=33)){var k=new Error("NavigatorUserMediaError");return k.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void n.error(k)}w(l={video:{mozMediaSource:t.video,mediaSource:t.video},audio:U(t)},function(e,n){if(b(e,n),!e)var r=n.currentTime,o=window.setInterval(function(){n||window.clearInterval(o),n.currentTime==r&&(window.clearInterval(o),n.onended&&n.onended()),r=n.currentTime},500)})}return void window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("janusGotScreen"==e.data.type&&m[e.data.id]){var r=m[e.data.id][0];if(delete m[e.data.id],""===e.data.sourceId){var o=new Error("NavigatorUserMediaError");o.name="You cancelled the request for permission, giving up...",i.consentDialog(!1),n.error(o)}else(l={audio:U(t),video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:t.screenshareFrameRate,maxFrameRate:t.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=e.data.sourceId,w(l,r)}else"janusGetScreenPending"==e.data.type&&window.clearTimeout(e.data.id)})}null!=t&&"screen"===t.video||navigator.mediaDevices.enumerateDevices().then(function(a){var s=a.some(function(e){return"audioinput"===e.kind}),d=a.some(function(e){return"videoinput"===e.kind}),l=U(t),f=G(t),v=function(e){return r.debug("isAudioSendRequired:",e),null!=e&&!1!==e.audio&&!1!==e.audioSend&&void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio}(t),p=function(e){return r.debug("isVideoSendRequired:",e),null!=e&&!1!==e.video&&!1!==e.videoSend&&void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo}(t);if(l||f||v||p){var g=!!l&&s,m=!!f&&d;if(!g&&!m)return i.consentDialog(!1),n.error("No capture device found"),!1;if(!g&&v)return i.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!m&&p)return i.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}navigator.mediaDevices.getUserMedia({audio:!!s&&u,video:!!d&&c}).then(function(r){i.consentDialog(!1),O(e,o,t,n,r)}).catch(function(e){i.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){i.consentDialog(!1),n.error("enumerateDevices error",e)})}else O(e,o,t,n)}function A(e,n){(n=n||{}).success="function"==typeof n.success?n.success:jQuery.noop,n.error="function"==typeof n.error?n.error:Q;var o=n.jsep,t=h[e];if(null==t||null===t.webrtcStuff||void 0===t.webrtcStuff)return r.warn("Invalid handle"),void n.error("Invalid handle");var i=t.webrtcStuff;if(null!=o){if(null===i.pc)return r.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void n.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");"edge"===adapter.browserDetails.browser&&(o.sdp+="a=end-of-candidates\r\n"),i.pc.setRemoteDescription(new RTCSessionDescription(o),function(){r.log("Remote description accepted!"),n.success()},n.error)}else n.error("Invalid JSEP")}function P(e,n,o){(o=o||{}).success="function"==typeof o.success?o.success:jQuery.noop,o.error="function"==typeof o.error?o.error:jQuery.noop;var t=h[e];if(null==t||null===t.webrtcStuff||void 0===t.webrtcStuff)return r.warn("Invalid handle"),void o.error("Invalid handle");var i=t.webrtcStuff;r.log("Creating offer (iceDone="+i.iceDone+")");var a=null;a="firefox"==adapter.browserDetails.browser||"edge"==adapter.browserDetails.browser?{offerToReceiveAudio:V(n),offerToReceiveVideo:W(n)}:{mandatory:{OfferToReceiveAudio:V(n),OfferToReceiveVideo:W(n)}},r.debug(a),i.pc.createOffer(function(e){if(r.debug(e),null!==i.mySdp&&void 0!==i.mySdp||(r.log("Setting local description"),i.mySdp=e.sdp,i.pc.setLocalDescription(e)),i.iceDone||i.trickle)if(i.sdpSent)r.log("Offer already sent, not sending it again");else{r.log("Offer ready"),r.debug(o),i.sdpSent=!0;var n={type:e.type,sdp:e.sdp};o.success(n)}else r.log("Waiting for all candidates...")},o.error,a)}function _(e,n,o){(o=o||{}).success="function"==typeof o.success?o.success:jQuery.noop,o.error="function"==typeof o.error?o.error:jQuery.noop;var t=h[e];if(null==t||null===t.webrtcStuff||void 0===t.webrtcStuff)return r.warn("Invalid handle"),void o.error("Invalid handle");var i=t.webrtcStuff;r.log("Creating answer (iceDone="+i.iceDone+")");var a=null;a="firefox"==adapter.browserDetails.browser||"edge"==adapter.browserDetails.browser?{offerToReceiveAudio:V(n),offerToReceiveVideo:W(n)}:{mandatory:{OfferToReceiveAudio:V(n),OfferToReceiveVideo:W(n)}},r.debug(a),i.pc.createAnswer(function(e){if(r.debug(e),null!==i.mySdp&&void 0!==i.mySdp||(r.log("Setting local description"),i.mySdp=e.sdp,i.pc.setLocalDescription(e)),i.iceDone||i.trickle)if(i.sdpSent)r.log("Answer already sent, not sending it again");else{i.sdpSent=!0;var n={type:e.type,sdp:e.sdp};o.success(n)}else r.log("Waiting for all candidates...")},o.error,a)}function E(e){var n=h[e];if(null==n||null===n.webrtcStuff||void 0===n.webrtcStuff)return r.warn("Invalid handle"),0;var o=n.webrtcStuff;return o.pc.getStats&&"chrome"==adapter.browserDetails.browser?null===o.remoteStream||void 0===o.remoteStream?(r.warn("Remote stream unavailable"),0):null===o.volume.timer||void 0===o.volume.timer?(r.log("Starting volume monitor"),o.volume.timer=setInterval(function(){o.pc.getStats(function(e){for(var n=e.result(),r=0;r<n.length;r++){var t=n[r];"ssrc"==t.type&&t.stat("audioOutputLevel")&&(o.volume.value=t.stat("audioOutputLevel"))}})},200),0):o.volume.value:(r.log("Getting the remote volume unsupported by browser"),0)}function N(e,n){var o=h[e];if(null==o||null===o.webrtcStuff||void 0===o.webrtcStuff)return r.warn("Invalid handle"),!0;var t=o.webrtcStuff;return null===t.pc||void 0===t.pc?(r.warn("Invalid PeerConnection"),!0):void 0===t.myStream||null===t.myStream?(r.warn("Invalid local MediaStream"),!0):n?null===t.myStream.getVideoTracks()||void 0===t.myStream.getVideoTracks()||0===t.myStream.getVideoTracks().length?(r.warn("No video track"),!0):!t.myStream.getVideoTracks()[0].enabled:null===t.myStream.getAudioTracks()||void 0===t.myStream.getAudioTracks()||0===t.myStream.getAudioTracks().length?(r.warn("No audio track"),!0):!t.myStream.getAudioTracks()[0].enabled}function F(e,n,o){var t=h[e];if(null==t||null===t.webrtcStuff||void 0===t.webrtcStuff)return r.warn("Invalid handle"),!1;var i=t.webrtcStuff;return null===i.pc||void 0===i.pc?(r.warn("Invalid PeerConnection"),!1):void 0===i.myStream||null===i.myStream?(r.warn("Invalid local MediaStream"),!1):n?null===i.myStream.getVideoTracks()||void 0===i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length?(r.warn("No video track"),!1):(i.myStream.getVideoTracks()[0].enabled=!o,!0):null===i.myStream.getAudioTracks()||void 0===i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length?(r.warn("No audio track"),!1):(i.myStream.getAudioTracks()[0].enabled=!o,!0)}function J(e){var n=h[e];if(null==n||null===n.webrtcStuff||void 0===n.webrtcStuff)return r.warn("Invalid handle"),"Invalid handle";var o=n.webrtcStuff;if(null===o.pc||void 0===o.pc)return"Invalid PeerConnection";if(o.pc.getStats&&"chrome"==adapter.browserDetails.browser)return null===o.remoteStream||void 0===o.remoteStream?(r.warn("Remote stream unavailable"),"Remote stream unavailable"):null===o.bitrate.timer||void 0===o.bitrate.timer?(r.log("Starting bitrate timer (Chrome)"),o.bitrate.timer=setInterval(function(){o.pc.getStats(function(e){for(var n=e.result(),r=0;r<n.length;r++){var t=n[r];if("ssrc"==t.type&&t.stat("googFrameHeightReceived"))if(o.bitrate.bsnow=t.stat("bytesReceived"),o.bitrate.tsnow=t.timestamp,null===o.bitrate.bsbefore||null===o.bitrate.tsbefore)o.bitrate.bsbefore=o.bitrate.bsnow,o.bitrate.tsbefore=o.bitrate.tsnow;else{var i=Math.round(8*(o.bitrate.bsnow-o.bitrate.bsbefore)/(o.bitrate.tsnow-o.bitrate.tsbefore));o.bitrate.value=i+" kbits/sec",o.bitrate.bsbefore=o.bitrate.bsnow,o.bitrate.tsbefore=o.bitrate.tsnow}}})},1e3),"0 kbits/sec"):o.bitrate.value;if(o.pc.getStats&&"firefox"==adapter.browserDetails.browser){if(null===o.remoteStream||void 0===o.remoteStream||null===o.remoteStream.stream||void 0===o.remoteStream.stream)return r.warn("Remote stream unavailable"),"Remote stream unavailable";var t=o.remoteStream.stream.getVideoTracks();return null==t||t.length<1?(r.warn("No video track"),"No video track"):null===o.bitrate.timer||void 0===o.bitrate.timer?(r.log("Starting bitrate timer (Firefox)"),o.bitrate.timer=setInterval(function(){var e=function(e){if(null!=e&&null!=e.inbound_rtp_video_1&&null!=e.inbound_rtp_video_1)if(o.bitrate.bsnow=e.inbound_rtp_video_1.bytesReceived,o.bitrate.tsnow=e.inbound_rtp_video_1.timestamp,null===o.bitrate.bsbefore||null===o.bitrate.tsbefore)o.bitrate.bsbefore=o.bitrate.bsnow,o.bitrate.tsbefore=o.bitrate.tsnow;else{var n=Math.round(8*(o.bitrate.bsnow-o.bitrate.bsbefore)/(o.bitrate.tsnow-o.bitrate.tsbefore));o.bitrate.value=n+" kbits/sec",o.bitrate.bsbefore=o.bitrate.bsnow,o.bitrate.tsbefore=o.bitrate.tsnow}else o.bitrate.value="Missing inbound_rtp_video_1"};o.pc.getStats(t[0],function(n){e(n)},e)},1e3),"0 kbits/sec"):o.bitrate.value}return r.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"}function Q(e){r.error("WebRTC error:",e)}function L(e,t){r.log("Cleaning WebRTC stuff");var i=h[e];if(null!=i){var a=i.webrtcStuff;if(null!=a){if(!0===t){var s={janus:"hangup",transaction:r.randomString(12)};null!=p&&(s.token=p),null!=g&&(s.apisecret=g),r.debug("Sending hangup request (handle="+e+"):"),r.debug(s),n?(s.session_id=b,s.handle_id=e,o.send(JSON.stringify(s))):$.ajax({type:"POST",url:d+"/"+b+"/"+e,xhrFields:{withCredentials:f},cache:!1,contentType:"application/json",data:JSON.stringify(s),dataType:"json"})}a.remoteStream=null,a.volume.timer&&clearInterval(a.volume.timer),a.volume.value=null,a.bitrate.timer&&clearInterval(a.bitrate.timer),a.bitrate.timer=null,a.bitrate.bsnow=null,a.bitrate.bsbefore=null,a.bitrate.tsnow=null,a.bitrate.tsbefore=null,a.bitrate.value=null;try{a.streamExternal||null===a.myStream||void 0===a.myStream||(r.log("Stopping local stream"),a.myStream.stop())}catch(e){}try{if(!a.streamExternal&&null!==a.myStream&&void 0!==a.myStream){r.log("Stopping local stream tracks");var l=a.myStream.getTracks();for(var u in l){var c=l[u];r.log(c),null!=c&&c.stop()}}}catch(e){}a.streamExternal=!1,a.myStream=null;try{a.pc.close()}catch(e){}a.pc=null,a.mySdp=null,a.iceDone=!1,a.sdpSent=!1,a.dataChannel=null,a.dtmfSender=null}i.oncleanup()}}function U(e){return r.debug("isAudioSendEnabled:",e),null==e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function V(e){return r.debug("isAudioRecvEnabled:",e),null==e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function G(e){return r.debug("isVideoSendEnabled:",e),null==e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function W(e){return r.debug("isVideoRecvEnabled:",e),null==e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}!function l(u){var c=r.randomString(12);var v={janus:"create",transaction:c};null!=p&&(v.token=p);null!=g&&(v.apisecret=g);null===d&&$.isArray(a)&&(0===(d=a[s]).indexOf("ws")?(n=!0,r.log("Server #"+(s+1)+": trying WebSockets to contact Janus ("+d+")")):(n=!1,r.log("Server #"+(s+1)+": trying REST API to contact Janus ("+d+")")));if(n){for(var h in o=new WebSocket(d,"janus-protocol"),t={error:function(){if(r.error("Error connecting to the Janus WebSockets server... "+d),$.isArray(a))return++s==a.length?void u.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(d=null,void setTimeout(function(){l(u)},200));u.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){S[c]=function(e){if(r.debug(e),"success"!==e.janus)return r.error("Ooops: "+e.error.code+" "+e.error.reason),void u.error(e.error.reason);i=setTimeout(j,3e4),m=!0,b=e.data.id,r.log("Created session: "+b),r.sessions[b]=w,u.success()},o.send(JSON.stringify(v))},message:function(e){k(JSON.parse(e.data))},close:function(){null!==d&&m&&(m=!1,e.error("Lost connection to the gateway (is it down?)"))}})o.addEventListener(h,t[h]);return}$.ajax({type:"POST",url:d,xhrFields:{withCredentials:f},cache:!1,contentType:"application/json",data:JSON.stringify(v),success:function(e){if(r.debug(e),"success"!==e.janus)return r.error("Ooops: "+e.error.code+" "+e.error.reason),void u.error(e.error.reason);m=!0,b=e.data.id,r.log("Created session: "+b),r.sessions[b]=w,x(),u.success()},error:function(e,n,o){if(r.error(n+": "+o),$.isArray(a))return++s==a.length?void u.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(d=null,void setTimeout(function(){l(u)},200));""===o?u.error(n+": Is the gateway down?"):u.error(n+": "+o)},dataType:"json"})}(e),this.getServer=function(){return d},this.isConnected=function(){return m},this.getSessionId=function(){return b},this.destroy=function(a){!function(a){(a=a||{}).success="function"==typeof a.success?a.success:jQuery.noop;var s=!0;void 0!==a.asyncRequest&&null!==a.asyncRequest&&(s=!0===a.asyncRequest);if(r.log("Destroying session "+b+" (async="+s+")"),!m)return r.warn("Is the gateway down? (connected=false)"),void a.success();if(null==b)return r.warn("No session to destroy"),a.success(),void e.destroyed();delete r.sessions[b];var l={janus:"destroy",transaction:r.randomString(12)};null!=p&&(l.token=p);null!=g&&(l.apisecret=g);if(n){l.session_id=b;var u=function(){for(var e in t)o.removeEventListener(e,t[e]);o.removeEventListener("message",c),o.removeEventListener("error",v),i&&clearTimeout(i)},c=function(n){var r=JSON.parse(n.data);r.session_id==l.session_id&&r.transaction==l.transaction&&(u(),a.success(),e.destroyed())},v=function(n){u(),a.error("Failed to destroy the gateway: Is the gateway down?"),e.destroyed()};return o.addEventListener("message",c),o.addEventListener("error",v),void o.send(JSON.stringify(l))}$.ajax({type:"POST",url:d+"/"+b,async:s,xhrFields:{withCredentials:f},cache:!1,contentType:"application/json",data:JSON.stringify(l),success:function(n){r.log("Destroyed session:"),r.debug(n),b=null,m=!1,"success"!==n.janus&&r.error("Ooops: "+n.error.code+" "+n.error.reason),a.success(),e.destroyed()},error:function(n,o,t){r.error(o+": "+t),b=null,m=!1,a.success(),e.destroyed()},dataType:"json"})}(a)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:jQuery.noop,e.error="function"==typeof e.error?e.error:jQuery.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:jQuery.noop,e.iceState="function"==typeof e.iceState?e.iceState:jQuery.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:jQuery.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:jQuery.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:jQuery.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:jQuery.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:jQuery.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:jQuery.noop,e.ondata="function"==typeof e.ondata?e.ondata:jQuery.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:jQuery.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:jQuery.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:jQuery.noop,!m)return r.warn("Is the gateway down? (connected=false)"),void e.error("Is the gateway down? (connected=false)");var t=e.plugin;if(null==t)return r.error("Invalid plugin"),void e.error("Invalid plugin");var i=e.opaqueId,a=r.randomString(12),s={janus:"attach",plugin:t,opaque_id:i,transaction:a};null!=p&&(s.token=p);null!=g&&(s.apisecret=g);if(n)return S[a]=function(n){if(r.debug(n),"success"!==n.janus)return r.error("Ooops: "+n.error.code+" "+n.error.reason),void e.error("Ooops: "+n.error.code+" "+n.error.reason);var o=n.data.id;r.log("Created handle: "+o);var i={session:w,plugin:t,id:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return o},getPlugin:function(){return t},getVolume:function(){return E(o)},isAudioMuted:function(){return N(o,!1)},muteAudio:function(){return F(o,!1,!0)},unmuteAudio:function(){return F(o,!1,!1)},isVideoMuted:function(){return N(o,!0)},muteVideo:function(){return F(o,!0,!0)},unmuteVideo:function(){return F(o,!0,!1)},getBitrate:function(){return J(o)},send:function(e){T(o,e)},data:function(e){I(o,e)},dtmf:function(e){R(o,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){M(o,e)},createAnswer:function(e){M(o,e)},handleRemoteJsep:function(e){A(o,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){L(o,!0===e)},detach:function(e){C(o,e)}};h[o]=i,e.success(i)},s.session_id=b,void o.send(JSON.stringify(s));$.ajax({type:"POST",url:d+"/"+b,xhrFields:{withCredentials:f},cache:!1,contentType:"application/json",data:JSON.stringify(s),success:function(n){if(r.debug(n),"success"!==n.janus)return r.error("Ooops: "+n.error.code+" "+n.error.reason),void e.error("Ooops: "+n.error.code+" "+n.error.reason);var o=n.data.id;r.log("Created handle: "+o);var i={session:w,plugin:t,id:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return o},getPlugin:function(){return t},getVolume:function(){return E(o)},isAudioMuted:function(){return N(o,!1)},muteAudio:function(){return F(o,!1,!0)},unmuteAudio:function(){return F(o,!1,!1)},isVideoMuted:function(){return N(o,!0)},muteVideo:function(){return F(o,!0,!0)},unmuteVideo:function(){return F(o,!0,!1)},getBitrate:function(){return J(o)},send:function(e){T(o,e)},data:function(e){I(o,e)},dtmf:function(e){R(o,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){M(o,e)},createAnswer:function(e){M(o,e)},handleRemoteJsep:function(e){A(o,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){L(o,!0===e)},detach:function(e){C(o,e)}};h[o]=i,e.success(i)},error:function(e,n,o){r.error(n+": "+o)},dataType:"json"})}(e)}}r.sessions={},r.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",r.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),n=33;return window.navigator.userAgent.match("Linux")&&(n=35),e>=26&&e<=n||$("#janus-extension-installed").length>0}return!0},r.noop=function(){},r.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:r.noop,!0===r.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),r.trace=r.noop,r.debug=r.noop,r.vdebug=r.noop,r.log=r.noop,r.warn=r.noop,r.error=r.noop,!0===e.debug||"all"===e.debug)r.trace=console.trace.bind(console),r.debug=console.debug.bind(console),r.vdebug=console.debug.bind(console),r.log=console.log.bind(console),r.warn=console.warn.bind(console),r.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var n in e.debug){var o=e.debug[n];switch(o){case"trace":r.trace=console.trace.bind(console);break;case"debug":r.debug=console.debug.bind(console);break;case"vdebug":r.vdebug=console.debug.bind(console);break;case"log":r.log=console.log.bind(console);break;case"warn":r.warn=console.warn.bind(console);break;case"error":r.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+o+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}r.log("Initializing library"),r.listDevices=function(e){e="function"==typeof e?e:r.noop,navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(n){navigator.mediaDevices.enumerateDevices().then(function(o){r.debug(o),e(o);try{n.stop()}catch(e){}try{var t=n.getTracks();for(var i in t){var a=t[i];null!=a&&a.stop()}}catch(e){}})}).catch(function(n){r.error(n),e([])}):(r.warn("navigator.mediaDevices unavailable"),e([]))},r.attachMediaStream=function(e,n){"chrome"===adapter.browserDetails.browser?adapter.browserDetails.version>=43?e.srcObject=n:void 0!==e.src?e.src=URL.createObjectURL(n):r.error("Error attaching stream to element"):"safari"===adapter.browserDetails.browser||window.navigator.userAgent.match(/iPad/i)||window.navigator.userAgent.match(/iPhone/i)?e.src=URL.createObjectURL(n):e.srcObject=n},r.reattachMediaStream=function(e,n){"chrome"===adapter.browserDetails.browser?adapter.browserDetails.version>=43?e.srcObject=n.srcObject:void 0!==e.src&&(e.src=n.src):"safari"===adapter.browserDetails.browser||window.navigator.userAgent.match(/iPad/i)||window.navigator.userAgent.match(/iPhone/i)?e.src=n.src:e.srcObject=n.srcObject};var t=window.onbeforeunload;window.onbeforeunload=function(){for(var e in r.log("Closing window"),r.sessions)null!==r.sessions[e]&&void 0!==r.sessions[e]&&r.sessions[e].destroyOnUnload&&(r.log("Destroying session "+e),r.sessions[e].destroy({asyncRequest:!1}));t&&"function"==typeof t&&t()},r.initDone=!0,e.callback()}},r.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},r.randomString=function(e){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",o=0;o<e;o++){var t=Math.floor(Math.random()*n.length);r+=n.substring(t,t+1)}return r};var o=null;o="wss://rtc.exp.bcelive.com:8989/janus";var t=null,i=null,a="brtc-client-"+r.randomString(12),s=!1,d=null,l=null,u=null,c=[],f=[],v="",p=null,g=null,m=null,b=null,h=null,w=10,y="h264",S=!0,x=!0,k=!1,j=function(){},T=function(e){},D=function(e){};function I(e){var n=!0,o=!1;S||(n=!1,e=!1,o=!0),$("#publish").attr("disabled",!0).unbind("click"),i.createOffer({media:{audioRecv:!1,videoRecv:!1,audioSend:e,videoSend:n,data:o},success:function(o){r.debug("Got publisher SDP!"),r.debug(o);var t={request:"configure",audio:e,video:n};i.send({message:t,jsep:o})},error:function(n){r.error("WebRTC error:",n),e?I(!1):(bootbox.alert("WebRTC error... "+JSON.stringify(n)),$("#publish").removeAttr("disabled").click(function(){I(!0)}))}})}function R(e,n){var o=null;t.attach({plugin:"janus.plugin.videoroom",opaqueId:a,success:function(n){o=n,r.log("Plugin attached! ("+o.getPlugin()+", id="+o.getId()+")"),r.log("  -- This is a subscriber");var t={request:"join",room:parseInt(w),room_name:g,ptype:"listener",id:parseInt(b),app_id:p,role:m,token:v,feed:e,private_id:u};o.send({message:t})},error:function(e){r.error("  -- Error attaching plugin...",e),bootbox.alert("Error attaching plugin... "+e)},onmessage:function(e,n){r.debug(" ::: Got a message (listener) :::"),r.debug(JSON.stringify(e));var t=e.videoroom;if(r.debug("Event: "+t),null!=t&&null!=t)if("attached"===t){for(var i=1;i<6;i++)if(void 0===c[i]||null===c[i]){c[i]=o,o.rfindex=i;break}if(o.rfid=e.id,o.rfdisplay=e.display,void 0===o.spinner||null===o.spinner){var a=document.getElementById("videoremote"+o.rfindex);o.spinner=new Spinner({top:100}).spin(a)}else o.spinner.spin();r.log("Successfully attached to feed "+o.rfid+" ("+o.rfdisplay+") in room "+e.room),$("#remote"+o.rfindex).removeClass("hide").html(o.rfdisplay).show()}else void 0!==e.error&&null!==e.error&&bootbox.alert(e.error);null!=n&&(r.debug("Handling SDP as well..."),r.debug(n),o.createAnswer({jsep:n,media:{audioSend:!1,videoSend:!1},success:function(e){r.debug("Got SDP!"),r.debug(e);o.send({message:{request:"start",room:1234},jsep:e})},error:function(e){r.error("WebRTC error:",e),bootbox.alert("WebRTC error... "+JSON.stringify(e))}}))},webrtcState:function(e){r.log("Janus says this WebRTC PeerConnection (feed #"+o.rfindex+") is "+(e?"up":"down")+" now")},onlocalstream:function(e){},onremotestream:function(e){if(r.debug("Remote feed #"+o.rfindex),T(o.rfindex),0===$("#remotevideo"+o.rfindex).length){var n="";k&&(n="muted"),$("#videoremote"+o.rfindex).append('<video class="rounded centered" id="waitingvideo'+o.rfindex+'" width=320 height=240 />'),$("#videoremote"+o.rfindex).append("<video "+n+' style="rotation: 180deg" id="remotevideo'+o.rfindex+'" width="100%" height="100%" autoplay/>')}x&&$("#videoremote"+o.rfindex).append('<span class="label label-primary hide" id="curres'+o.rfindex+'" style="position: absolute; bottom: 0px; left: 0px; margin: 2px;"></span><span class="label label-info hide" id="curbitrate'+o.rfindex+'" style="position: absolute; bottom: 0px; right: 0px; margin: 2px;"></span>'),$("#remotevideo"+o.rfindex).bind("playing",function(){void 0!==o.spinner&&null!==o.spinner&&o.spinner.stop(),o.spinner=null,$("#waitingvideo"+o.rfindex).remove(),$("#remotevideo"+o.rfindex).removeClass("hide");var e=this.videoWidth,n=this.videoHeight;$("#curres"+o.rfindex).removeClass("hide").text(e+"x"+n).show(),"firefox"===adapter.browserDetails.browser&&setTimeout(function(){var e=$("#remotevideo"+o.rfindex).get(0).videoWidth,n=$("#remotevideo"+o.rfindex).get(0).videoHeight;$("#curres"+o.rfindex).removeClass("hide").text(e+"x"+n).show()},2e3)}),r.attachMediaStream($("#remotevideo"+o.rfindex).get(0),e);var t=e.getVideoTracks();null!=t&&0!==t.length||($("#remotevideo"+o.rfindex).hide(),$("#videoremote"+o.rfindex).append('<div class="no-video-container"><i class="fa fa-video-camera fa-5 no-video-icon" style="height: 100%;"></i><span class="no-video-text" style="font-size: 16px;">No remote video available</span></div>')),"chrome"!==adapter.browserDetails.browser&&"firefox"!==adapter.browserDetails.browser||($("#curbitrate"+o.rfindex).removeClass("hide").show(),f[o.rfindex]=setInterval(function(){var e=o.getBitrate();$("#curbitrate"+o.rfindex).text(e)},1e3))},oncleanup:function(){r.log(" ::: Got a cleanup notification (remote feed "+e+") :::"),D(o.rfindex),void 0!==o.spinner&&null!==o.spinner&&o.spinner.stop(),o.spinner=null,$("#waitingvideo"+o.rfindex).remove(),$("#curbitrate"+o.rfindex).remove(),$("#curres"+o.rfindex).remove(),null!==f[o.rfindex]&&null!==f[o.rfindex]&&clearInterval(f[o.rfindex]),f[o.rfindex]=null}})}window.BRTC_Start=function(e){(e=e||{}).success="function"==typeof e.success?e.success:jQuery.noop,e.error="function"==typeof e.error?e.error:jQuery.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:jQuery.noop,null!==e.server&&void 0!==e.server&&(o=e.server),null!==e.videocodec&&void 0!==e.videocodec&&(y=e.videocodec),null!==e.aspublisher&&void 0!==e.aspublisher&&(S=e.aspublisher),null!==e.aslistener&&void 0!==e.aslistener&&e.aslistener,null!==e.showvideobps&&void 0!==e.showvideobps&&(x=e.showvideobps),null!==e.autoplaymuted&&void 0!==e.autoplaymuted&&(k=e.autoplaymuted),window.location.hostname.includes("neolix")&&(k=!0),o=o+"?appid="+e.appid+"&roomname="+e.roomname+"&uid="+e.userid+"&token="+e.token,s||(s=!0,j=e.success,null!==e.remotevideoon&&void 0!==e.remotevideoon&&(T=e.remotevideoon),null!==e.remotevideooff&&void 0!==e.remotevideooff&&(D=e.remotevideooff),r.isWebrtcSupported()?(g=e.roomname,b=e.userid,p=e.appid,h=e.displayname,S||(h+=":web_listener"),m="publisher","videoremote1"!=e.remotevideoviewid&&$("#"+e.remotevideoviewid).append('<div style="width: 100%;height: 100%;" id="videoremote1"></div>'),"videolocal"!=e.localvideoviewid&&$("#"+e.localvideoviewid).append('<div  id="videolocal"></div>'),"videoremote2"!=e.remotevideoviewid2&&$("#"+e.remotevideoviewid2).append('<div style="width: 100%;height: 100%;" id="videoremote2"></div>'),"videoremote3"!=e.remotevideoviewid3&&$("#"+e.remotevideoviewid3).append('<div style="width: 100%;height: 100%;" id="videoremote3"></div>'),"videoremote4"!=e.remotevideoviewid4&&$("#"+e.remotevideoviewid4).append('<div style="width: 100%;height: 100%;" id="videoremote4"></div>'),"videoremote5"!=e.remotevideoviewid5&&$("#"+e.remotevideoviewid5).append('<div style="width: 100%;height: 100%;" id="videoremote5"></div>'),r.init({debug:"all",callback:function(){t=new r({server:o,success:function(){t.attach({plugin:"janus.plugin.videoroom",opaqueId:a,success:function(e){var n,o;$("#details").remove(),$("#rtc_logo_img").remove(),i=e,r.log("Plugin attached! ("+i.getPlugin()+", id="+i.getId()+")"),r.log("  -- This is a publisher/manager"),n=h,o={request:"create",id:parseInt(b),room_name:g,publishers:6,videocodec:y,app_id:p},i.send({message:o,success:function(e){r.log("create resp data:"+e),w=e.room,r.log("create roomid:"+w);var o={request:"join",room:parseInt(w),room_name:g,ptype:"publisher",id:parseInt(b),app_id:p,role:m,token:"no_token",display:n};d=n,r.log("userid:"+b+",appid:"+p),i.send({message:o})}}),j()},error:function(e){r.error("  -- Error attaching plugin...",e),bootbox.alert("Error attaching plugin... "+e)},consentDialog:function(e){r.debug("Consent dialog should be "+(e?"on":"off")+" now"),e?$.blockUI({message:'<div><img src="up_arrow.png"/></div>',css:{border:"none",padding:"15px",backgroundColor:"transparent",color:"#aaa",top:"10px",left:navigator.mozGetUserMedia?"-100px":"300px"}}):$.unblockUI()},mediaState:function(e,n){r.log("Janus "+(n?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){r.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now"),$("#videolocal").parent().parent().unblock()},onmessage:function(e,n){r.debug(" ::: Got a message (publisher) :::"),r.debug(JSON.stringify(e));var o=e.videoroom;if(r.debug("Event: "+o),null!=o&&null!=o)if("joined"===o){if(l=e.id,u=e.private_id,r.log("Successfully joined room "+e.room+" with ID "+l),I(!0),void 0!==e.publishers&&null!==e.publishers){var t=e.publishers;for(var a in r.debug("Got a list of available publishers/feeds:"),r.debug(t),t){var s=t[a].id,d=t[a].display;r.debug("  >> ["+s+"] "+d),void 0!==d&&d.includes("web_listener")||R(s,d)}}}else if("destroyed"===o)r.warn("The room has been destroyed!"),bootbox.alert("The room has been destroyed",function(){window.location.reload()});else if("event"===o)if(void 0!==e.publishers&&null!==e.publishers){var t=e.publishers;for(var a in r.debug("Got a list of available publishers/feeds:"),r.debug(t),t){var s=t[a].id,d=t[a].display;r.debug("  >> ["+s+"] "+d),void 0!==d&&d.includes("web_listener")||R(s,d)}}else if(void 0!==e.leaving&&null!==e.leaving){var f=e.leaving;r.log("Publisher left: "+f);for(var v=null,p=1;p<6;p++)if(null!=c[p]&&null!=c[p]&&c[p].rfid==f){v=c[p];break}null!=v&&(r.debug("Feed "+v.rfid+" ("+v.rfdisplay+") has left the room, detaching"),$("#remote"+v.rfindex).empty().hide(),$("#videoremote"+v.rfindex).empty(),c[v.rfindex]=null,v.detach())}else if(void 0!==e.unpublished&&null!==e.unpublished){var g=e.unpublished;if(r.log("Publisher left: "+g),"ok"===g)return void i.hangup();for(var v=null,p=1;p<6;p++)if(null!=c[p]&&null!=c[p]&&c[p].rfid==g){v=c[p];break}null!=v&&(r.debug("Feed "+v.rfid+" ("+v.rfdisplay+") has left the room, detaching"),$("#remote"+v.rfindex).empty().hide(),$("#videoremote"+v.rfindex).empty(),c[v.rfindex]=null,v.detach())}else void 0!==e.error&&null!==e.error&&bootbox.alert(e.error);null!=n&&(r.debug("Handling SDP as well..."),r.debug(n),i.handleRemoteJsep({jsep:n}))},onlocalstream:function(e){if(r.debug(" ::: Got a local stream :::"),S){e,r.debug(JSON.stringify(e)),$("#videolocal").empty(),$("#videojoin").hide(),$("#videos").removeClass("hide").show(),0===$("#myvideo").length&&$("#videolocal").append('<video class="centered" id="myvideo" width="100%" height="100%" autoplay muted="muted"/>'),$("#publisher").removeClass("hide").html(d).show(),r.attachMediaStream($("#myvideo").get(0),e),$("#myvideo").get(0).muted="muted",$("#videolocal").parent().parent().block({message:"<b>Publishing...</b>",css:{border:"none",backgroundColor:"transparent",color:"white"}});var n=e.getVideoTracks();null!=n&&0!==n.length||($("#myvideo").hide(),$("#videolocal").append('<div class="no-video-container"><i class="fa fa-video-camera fa-5 no-video-icon" style="height: 100%;"></i><span class="no-video-text" style="font-size: 16px;">No webcam available</span></div>'))}},onremotestream:function(e){},oncleanup:function(){r.log(" ::: Got a cleanup notification: we are unpublished now :::"),null,$("#videolocal").html('<button id="publish" class="btn btn-primary">Publish</button>'),$("#publish").click(function(){I(!0)}),$("#videolocal").parent().parent().unblock()}})},error:function(e){r.error(e),bootbox.alert(e,function(){window.location.reload()})},destroyed:function(){window.location.reload()}})}})):bootbox.alert("No WebRTC support... "))},window.BRTC_Stop=function(){null!=t&&t.destroy()},window.BRTC_Version=function(){return"BRTC SDK V0.5"}}]);